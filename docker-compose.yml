version: '3.8'
services:
  backend:
    container_name: clinical-backend
    build:
      context: .
      dockerfile: Dockerfile.backend
    ports:
      - "8080:8080"
    environment:
      # Neo4j (clinical knowledge graph)
      NEO4J_URI: bolt://neo4j:7687
      NEO4J_USER: neo4j
      NEO4J_PASSWORD: password

      # MemMachine (assistant memory â€“ non-PHI)
      MEMMACHINE_BASE_URL: http://memmachine:8001
      MEMMACHINE_API_KEY: dev
      FRONTEND_URL: http://localhost:5174
    depends_on:
      - neo4j
      - memmachine

  frontend:
    container_name: clinical-frontend
    build:
      context: .
      dockerfile: Dockerfile.frontend
    ports:
      - "5174:80"
    depends_on:
      - backend

  neo4j:
    container_name: clinical-neo4j
    image: neo4j:5
    ports:
      - "7474:7474"
      - "7687:7687"
    environment:
      NEO4J_AUTH: neo4j/password
    volumes:
      - neo4j_data:/data

  memmachine:
    container_name: clinical-memmachine
    build:
      context: .
      dockerfile: Dockerfile.memmachine
    ports:
      - "8001:8001"
    environment:
      MEMMACHINE_API_KEY: dev
      MEMORY_CONFIG: /app/config/memmachine.yaml
    volumes:
      - memmachine_data:/data
      - ./memmachine.yaml:/app/config/memmachine.yaml:ro
    depends_on:
      - neo4j


volumes:
  neo4j_data:
  memmachine_data: